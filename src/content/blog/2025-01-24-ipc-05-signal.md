---
title: "Signal - ë¹„ë™ê¸° ì´ë²¤íŠ¸ í†µì‹ "
date: 2025-01-24
tags: [IPC, Signal, Linux, POSIX, System Programming]
description: "Unix Signalì˜ ê°œë…ê³¼ Signal Handler ì‘ì„± ë°©ë²•ì„ ìµíˆê³ , ë¹„ë™ê¸° ì´ë²¤íŠ¸ ì²˜ë¦¬ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤."
---

## ë“¤ì–´ê°€ë©°

**Signal**ì€ ë‹¤ë¥¸ IPCì™€ ë‹¤ë¦…ë‹ˆë‹¤. ë°ì´í„°ë¥¼ ì „ì†¡í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, **ë¹„ë™ê¸° ì´ë²¤íŠ¸**ë¥¼ ì•Œë¦½ë‹ˆë‹¤. Ctrl+Cë¥¼ ëˆ„ë¥´ë©´ í”„ë¡œê·¸ë¨ì´ ì¢…ë£Œë˜ëŠ” ê²ƒë„ Signal ë•ë¶„ì…ë‹ˆë‹¤.

## Signalì´ë€?

### ê°œë…

```mermaid
graph TB
    subgraph "Signal Sources"
        KB[í‚¤ë³´ë“œ<br/>Ctrl+C]
        Kernel[ì»¤ë„<br/>Segmentation Fault]
        Process[ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤<br/>kill()]
    end

    subgraph "Target Process"
        Handler[Signal Handler]
        Default[ê¸°ë³¸ ë™ì‘]
        Ignore[ë¬´ì‹œ]
    end

    KB -->|SIGINT| Handler
    Kernel -->|SIGSEGV| Default
    Process -->|SIGUSR1| Handler

    style Handler fill:#c8e6c9,stroke:#388e3c
    style Default fill:#ffccbc,stroke:#d84315
    style Ignore fill:#e0e0e0,stroke:#9e9e9e
```

### íŠ¹ì§•

- **ë¹„ë™ê¸°**: ì–¸ì œë“ ì§€ ë°œìƒ ê°€ëŠ¥
- **ì¸í„°ëŸ½íŠ¸**: í”„ë¡œê·¸ë¨ ì‹¤í–‰ ì¤‘ë‹¨
- **ìˆ«ì**: ì‹ í˜¸ ë²ˆí˜¸ë§Œ ì „ë‹¬ (ë°ì´í„° X)
- **í•¸ë“¤ëŸ¬**: ì‚¬ìš©ì ì •ì˜ ì²˜ë¦¬ ê°€ëŠ¥

## ì£¼ìš” Signal ëª©ë¡

```mermaid
graph TB
    Signals[Unix Signals]

    subgraph "ì¢…ë£Œ ì‹ í˜¸"
        SIGINT[SIGINT 2<br/>Ctrl+C]
        SIGTERM[SIGTERM 15<br/>ì •ìƒ ì¢…ë£Œ]
        SIGKILL[SIGKILL 9<br/>ê°•ì œ ì¢…ë£Œ]
        SIGQUIT[SIGQUIT 3<br/>Ctrl+\]
    end

    subgraph "ì—ëŸ¬ ì‹ í˜¸"
        SIGSEGV[SIGSEGV 11<br/>Segmentation Fault]
        SIGFPE[SIGFPE 8<br/>Division by Zero]
        SIGILL[SIGILL 4<br/>Illegal Instruction]
    end

    subgraph "ì‚¬ìš©ì ì •ì˜"
        SIGUSR1[SIGUSR1 10<br/>User Defined 1]
        SIGUSR2[SIGUSR2 12<br/>User Defined 2]
    end

    subgraph "ê¸°íƒ€"
        SIGCHLD[SIGCHLD 17<br/>Child Terminated]
        SIGALRM[SIGALRM 14<br/>Alarm Timer]
    end

    Signals --> SIGINT
    Signals --> SIGTERM
    Signals --> SIGKILL
    Signals --> SIGQUIT
    Signals --> SIGSEGV
    Signals --> SIGFPE
    Signals --> SIGILL
    Signals --> SIGUSR1
    Signals --> SIGUSR2
    Signals --> SIGCHLD
    Signals --> SIGALRM

    style SIGKILL fill:#ffccbc,stroke:#d84315
    style SIGSEGV fill:#ffccbc,stroke:#d84315
    style SIGUSR1 fill:#c8e6c9,stroke:#388e3c
    style SIGUSR2 fill:#c8e6c9,stroke:#388e3c
```

### ìƒì„¸ ëª©ë¡

| Signal | ë²ˆí˜¸ | ë°œìƒ ì›ì¸ | ê¸°ë³¸ ë™ì‘ | ì²˜ë¦¬ ê°€ëŠ¥ |
|--------|------|-----------|-----------|-----------|
| **SIGHUP** | 1 | í„°ë¯¸ë„ ì—°ê²° ëŠê¹€ | ì¢…ë£Œ | âœ… |
| **SIGINT** | 2 | Ctrl+C | ì¢…ë£Œ | âœ… |
| **SIGQUIT** | 3 | Ctrl+\ | ì¢…ë£Œ + Core dump | âœ… |
| **SIGILL** | 4 | ì˜ëª»ëœ ëª…ë ¹ì–´ | ì¢…ë£Œ + Core dump | âœ… |
| **SIGFPE** | 8 | 0ìœ¼ë¡œ ë‚˜ëˆ„ê¸° | ì¢…ë£Œ + Core dump | âœ… |
| **SIGKILL** | 9 | ê°•ì œ ì¢…ë£Œ | ì¢…ë£Œ | âŒ |
| **SIGSEGV** | 11 | ì˜ëª»ëœ ë©”ëª¨ë¦¬ ì ‘ê·¼ | ì¢…ë£Œ + Core dump | âœ… |
| **SIGTERM** | 15 | ì •ìƒ ì¢…ë£Œ ìš”ì²­ | ì¢…ë£Œ | âœ… |
| **SIGCHLD** | 17 | ìì‹ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ | ë¬´ì‹œ | âœ… |

## Signal Handler ì‘ì„±

### ê¸°ë³¸ ì‚¬ìš©ë²•

```c
#include <signal.h>

void signal_handler(int signum) {
    printf("Signal %d ë°›ìŒ\n", signum);
}

int main() {
    // SIGINT (Ctrl+C) í•¸ë“¤ëŸ¬ ë“±ë¡
    signal(SIGINT, signal_handler);

    while (1) {
        printf("ì‹¤í–‰ ì¤‘... (Ctrl+Cë¡œ ì¢…ë£Œ)\n");
        sleep(1);
    }

    return 0;
}
```

### ì‹¤í–‰

```bash
gcc -o signal_basic signal_basic.c
./signal_basic

# ì¶œë ¥:
# ì‹¤í–‰ ì¤‘... (Ctrl+Cë¡œ ì¢…ë£Œ)
# ì‹¤í–‰ ì¤‘... (Ctrl+Cë¡œ ì¢…ë£Œ)
# ^CSignal 2 ë°›ìŒ
# ì‹¤í–‰ ì¤‘... (Ctrl+Cë¡œ ì¢…ë£Œ)
```

### ë™ì‘ ê³¼ì •

```mermaid
sequenceDiagram
    participant U as User
    participant K as Kernel
    participant P as Process

    U->>K: Ctrl+C ì…ë ¥
    K->>P: SIGINT ì „ì†¡

    Note over P: í˜„ì¬ ì‹¤í–‰ ì¤‘ë‹¨
    P->>P: signal_handler() ì‹¤í–‰
    Note over P: í•¸ë“¤ëŸ¬ ì™„ë£Œ

    P->>P: ì›ë˜ ìœ„ì¹˜ë¡œ ë³µê·€
    Note over P: ê³„ì† ì‹¤í–‰
```

## ì•ˆì „í•œ Signal Handler

### ë¬¸ì œì : ì¬ì§„ì…ì„± (Reentrancy)

```c
// âŒ ìœ„í—˜í•œ ì½”ë“œ
int counter = 0;

void handler(int sig) {
    printf("Signal %d, counter=%d\n", sig, counter);
    counter++;  // ğŸ”¥ ê²½ìŸ ì¡°ê±´!
}

int main() {
    signal(SIGINT, handler);

    while (1) {
        counter++;
        usleep(100);
    }
}
```

### ë¬¸ì œ ì‹œë‚˜ë¦¬ì˜¤

```mermaid
sequenceDiagram
    participant Main as Main Thread
    participant Handler as Signal Handler

    Main->>Main: counter++
    Note over Main: counter = 5 ì½ìŒ
    Note over Main: ì¦ê°€ ì¤€ë¹„ ì¤‘...

    Handler->>Handler: SIGINT ë°›ìŒ
    Handler->>Handler: counter++ (5 â†’ 6)

    Note over Main: counter = 6ìœ¼ë¡œ ì“°ê¸°
    Note over Main: ğŸ”¥ Handler ë³€ê²½ ë¬´ì‹œë¨!
```

### í•´ê²°ì±… 1: Async-Signal-Safe í•¨ìˆ˜ë§Œ ì‚¬ìš©

**ì•ˆì „í•œ í•¨ìˆ˜**:
- `write()`, `read()`
- `_exit()`
- `signal()`, `sigaction()`

**ìœ„í—˜í•œ í•¨ìˆ˜** (ì‚¬ìš© ê¸ˆì§€):
- `printf()`, `malloc()`, `free()`
- ëŒ€ë¶€ë¶„ì˜ í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ í•¨ìˆ˜

### í•´ê²°ì±… 2: Atomic Flag

```c
#include <signal.h>
#include <stdatomic.h>

atomic_bool signal_received = false;

void handler(int sig) {
    signal_received = true;  // âœ… ì›ìì  ì—°ì‚°
}

int main() {
    signal(SIGINT, handler);

    while (!signal_received) {
        // ë©”ì¸ ë¡œì§
        sleep(1);
    }

    printf("ì¢…ë£Œ ì²˜ë¦¬...\n");
    return 0;
}
```

## sigaction: ì•ˆì „í•œ Signal ì²˜ë¦¬

### signal() vs sigaction()

| í•­ëª© | signal() | sigaction() |
|------|----------|-------------|
| **ì´ì‹ì„±** | êµ¬í˜„ë§ˆë‹¤ ë‹¤ë¦„ | POSIX í‘œì¤€ |
| **ì•ˆì „ì„±** | ë‚®ìŒ | ë†’ìŒ |
| **ê¸°ëŠ¥** | ì œí•œì  | í’ë¶€ |
| **ê¶Œì¥** | âŒ | âœ… |

### sigaction ì‚¬ìš©ë²•

```c
#include <signal.h>

void handler(int sig, siginfo_t *info, void *context) {
    write(STDOUT_FILENO, "SIGINT received\n", 16);
}

int main() {
    struct sigaction sa;

    // í•¸ë“¤ëŸ¬ ì„¤ì •
    sa.sa_sigaction = handler;
    sa.sa_flags = SA_SIGINFO;  // siginfo_t ì‚¬ìš©
    sigemptyset(&sa.sa_mask);  // ë¸”ë¡í•  ì‹ í˜¸ ì—†ìŒ

    // SIGINT í•¸ë“¤ëŸ¬ ë“±ë¡
    sigaction(SIGINT, &sa, NULL);

    while (1) {
        pause();  // ì‹ í˜¸ ëŒ€ê¸°
    }

    return 0;
}
```

### siginfo_t í™œìš©

```c
void handler(int sig, siginfo_t *info, void *context) {
    char buf[100];

    // ì‹ í˜¸ ë³´ë‚¸ í”„ë¡œì„¸ìŠ¤ ì •ë³´
    int len = snprintf(buf, sizeof(buf),
        "Signal %d from PID %d\n",
        sig, info->si_pid);

    write(STDOUT_FILENO, buf, len);
}
```

## ì‹¤ì „ ì˜ˆì œ: Graceful Shutdown

### ë¬¸ì œ

```bash
# í”„ë¡œê·¸ë¨ ê°•ì œ ì¢…ë£Œ ì‹œ ì •ë¦¬ ì‘ì—… ì—†ìŒ
$ ./myapp
^C  # ğŸ”¥ ë°ì´í„° ì†ì‹¤, ë¦¬ì†ŒìŠ¤ ëˆ„ìˆ˜
```

### í•´ê²°: SIGTERM/SIGINT ì²˜ë¦¬

```c
// graceful_shutdown.c
#include <stdio.h>
#include <signal.h>
#include <stdbool.h>
#include <unistd.h>

volatile sig_atomic_t shutdown_requested = 0;

void shutdown_handler(int sig) {
    shutdown_requested = 1;
}

int main() {
    // SIGTERM, SIGINT í•¸ë“¤ëŸ¬ ë“±ë¡
    signal(SIGTERM, shutdown_handler);
    signal(SIGINT, shutdown_handler);

    printf("ì„œë²„ ì‹œì‘ (PID: %d)\n", getpid());

    while (!shutdown_requested) {
        printf("ì‘ì—… ì¤‘...\n");
        sleep(1);
    }

    // ì •ë¦¬ ì‘ì—…
    printf("\nì¢…ë£Œ ì‹ í˜¸ ë°›ìŒ. ì •ë¦¬ ì¤‘...\n");
    printf("ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì¢…ë£Œ\n");
    printf("íŒŒì¼ ì €ì¥ ì™„ë£Œ\n");
    printf("ì•ˆì „í•˜ê²Œ ì¢…ë£Œë¨\n");

    return 0;
}
```

### ì‹¤í–‰

```bash
./graceful_shutdown

# ì¶œë ¥:
# ì„œë²„ ì‹œì‘ (PID: 12345)
# ì‘ì—… ì¤‘...
# ì‘ì—… ì¤‘...
# ^C
# ì¢…ë£Œ ì‹ í˜¸ ë°›ìŒ. ì •ë¦¬ ì¤‘...
# ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì¢…ë£Œ
# íŒŒì¼ ì €ì¥ ì™„ë£Œ
# ì•ˆì „í•˜ê²Œ ì¢…ë£Œë¨
```

## íƒ€ì´ë¨¸ Signal: SIGALRM

### alarm() ì‚¬ìš©

```c
#include <signal.h>
#include <unistd.h>

void timeout_handler(int sig) {
    printf("ì‹œê°„ ì´ˆê³¼!\n");
    exit(1);
}

int main() {
    signal(SIGALRM, timeout_handler);

    // 5ì´ˆ í›„ SIGALRM ë°œìƒ
    alarm(5);

    printf("5ì´ˆ ì•ˆì— ì‘ì—… ì™„ë£Œí•´ì•¼ í•¨...\n");
    sleep(10);  // 10ì´ˆ ëŒ€ê¸° (5ì´ˆì— ì¢…ë£Œë¨)

    printf("ì´ ì¤„ì€ ì‹¤í–‰ ì•ˆ ë¨\n");
    return 0;
}
```

### íƒ€ì„ì•„ì›ƒ íŒ¨í„´

```c
// ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì— íƒ€ì„ì•„ì›ƒ ì ìš©
alarm(10);  // 10ì´ˆ íƒ€ì„ì•„ì›ƒ

int result = slow_network_call();

alarm(0);  // íƒ€ì´ë¨¸ ì·¨ì†Œ

if (result == -1 && errno == EINTR) {
    printf("íƒ€ì„ì•„ì›ƒ ë°œìƒ\n");
}
```

## ìì‹ í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬: SIGCHLD

### Zombie í”„ë¡œì„¸ìŠ¤ ë°©ì§€

```c
#include <signal.h>
#include <sys/wait.h>

void sigchld_handler(int sig) {
    // ëª¨ë“  ì¢…ë£Œëœ ìì‹ í”„ë¡œì„¸ìŠ¤ íšŒìˆ˜
    while (waitpid(-1, NULL, WNOHANG) > 0);
}

int main() {
    signal(SIGCHLD, sigchld_handler);

    // ìì‹ í”„ë¡œì„¸ìŠ¤ ìƒì„±
    for (int i = 0; i < 5; i++) {
        if (fork() == 0) {
            // ìì‹
            sleep(i);
            exit(0);
        }
    }

    // ë¶€ëª¨ëŠ” ê³„ì† ì‹¤í–‰
    while (1) {
        printf("ë¶€ëª¨ ì‘ì—… ì¤‘...\n");
        sleep(1);
    }

    return 0;
}
```

### ë™ì‘ ê³¼ì •

```mermaid
sequenceDiagram
    participant P as Parent
    participant C1 as Child 1
    participant C2 as Child 2
    participant K as Kernel

    P->>C1: fork()
    P->>C2: fork()

    C1->>C1: ì‘ì—… ì™„ë£Œ
    C1->>K: exit()
    K->>P: SIGCHLD ì „ì†¡

    P->>P: sigchld_handler()
    P->>K: waitpid()
    K-->>P: Child 1 ì¢…ë£Œ ìƒíƒœ

    Note over C1: Zombie ë°©ì§€!
```

## Signal Masking (ì°¨ë‹¨)

### ê°œë…

```mermaid
graph TB
    subgraph "Signal Queue"
        SQ[SIGINT<br/>SIGUSR1<br/>SIGTERM]
    end

    subgraph "Process"
        Mask[Signal Mask<br/>ì°¨ë‹¨: SIGINT, SIGUSR1]
        Handler[Handler]
    end

    SQ -->|SIGINT| Mask
    SQ -->|SIGUSR1| Mask
    SQ -->|SIGTERM| Handler

    Note[SIGINT, SIGUSR1<br/>ëŒ€ê¸° ì¤‘...]

    style Mask fill:#ffccbc,stroke:#d84315
    style Handler fill:#c8e6c9,stroke:#388e3c
```

### ì‚¬ìš©ë²•

```c
#include <signal.h>

int main() {
    sigset_t mask, oldmask;

    // Signal set ì´ˆê¸°í™”
    sigemptyset(&mask);
    sigaddset(&mask, SIGINT);
    sigaddset(&mask, SIGUSR1);

    // Signal ì°¨ë‹¨
    sigprocmask(SIG_BLOCK, &mask, &oldmask);

    // ì´ êµ¬ê°„ì—ì„œëŠ” SIGINT, SIGUSR1 ë¬´ì‹œë¨
    printf("Critical section...\n");
    sleep(5);

    // Signal ì°¨ë‹¨ í•´ì œ
    sigprocmask(SIG_SETMASK, &oldmask, NULL);

    // ìŒ“ì¸ ì‹ í˜¸ ì „ë‹¬ë¨
    printf("Signal handling resumed\n");

    return 0;
}
```

## ì‹¤ì‹œê°„ Signal (POSIX)

### ì¼ë°˜ vs ì‹¤ì‹œê°„ Signal

| í•­ëª© | ì¼ë°˜ Signal | ì‹¤ì‹œê°„ Signal |
|------|-------------|---------------|
| **ë²”ìœ„** | 1-31 | 32-64 (SIGRTMIN ~ SIGRTMAX) |
| **íì‰** | âŒ ì¤‘ë³µ ë¬´ì‹œ | âœ… ëª¨ë‘ íì‰ |
| **ë°ì´í„° ì „ì†¡** | âŒ | âœ… (sigqueue) |
| **ìˆœì„œ ë³´ì¥** | âŒ | âœ… |

### ì‚¬ìš© ì˜ˆ

```c
// ì‹¤ì‹œê°„ Signal ì „ì†¡ (ë°ì´í„° í¬í•¨)
union sigval value;
value.sival_int = 42;

sigqueue(pid, SIGRTMIN, value);

// í•¸ë“¤ëŸ¬ì—ì„œ ë°ì´í„° ë°›ê¸°
void rt_handler(int sig, siginfo_t *info, void *context) {
    printf("Received value: %d\n", info->si_value.sival_int);
}
```

## ë‹¤ìŒ ë‹¨ê³„

Signalì˜ í•µì‹¬ ê°œë…ì„ ì™„ì „íˆ ì´í•´í–ˆìŠµë‹ˆë‹¤! IPC ì‹œë¦¬ì¦ˆë¥¼ ë§ˆì³¤ìœ¼ë¯€ë¡œ, ë‹¤ìŒ ì‹œë¦¬ì¦ˆì—ì„œëŠ”:
- **ZeroMQ** - ê³ ìˆ˜ì¤€ ë©”ì‹œì§• ë¼ì´ë¸ŒëŸ¬ë¦¬
- ë¶„ì‚° ì‹œìŠ¤í…œ í†µì‹ 
- ë‹¤ì–‘í•œ ë©”ì‹œì§• íŒ¨í„´

---

**ì‹œë¦¬ì¦ˆ ëª©ì°¨**
1. IPCë€ ë¬´ì—‡ì¸ê°€ - í”„ë¡œì„¸ìŠ¤ ê°„ í†µì‹ ì˜ í•„ìš”ì„±
2. IPC ë©”ì»¤ë‹ˆì¦˜ ì „ì²´ ê°œìš” - 7ê°€ì§€ ë°©ì‹ ë¹„êµ
3. Pipe - ê°€ì¥ ê¸°ë³¸ì ì¸ IPC
4. Named Pipe (FIFO) - ì´ë¦„ ìˆëŠ” íŒŒì´í”„
5. **Signal - ë¹„ë™ê¸° ì´ë²¤íŠ¸ í†µì‹ ** â† í˜„ì¬ ê¸€

> ğŸ’¡ **Quick Tip**: Signal handlerì—ì„œëŠ” async-signal-safe í•¨ìˆ˜ë§Œ ì‚¬ìš©í•˜ì„¸ìš”. `printf()`ëŠ” ìœ„í—˜í•˜ë©°, `write()`ë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤!
