---
title: "Pipe - ê°€ì¥ ê¸°ë³¸ì ì¸ IPC"
date: 2025-01-22
tags: [IPC, Pipe, Linux, C, System Programming]
description: "Unix Pipeì˜ ë™ì‘ ì›ë¦¬ë¥¼ ìƒì„¸íˆ ì´í•´í•˜ê³ , ì‹¤ì „ íŒŒì´í”„ë¼ì¸ êµ¬ì¶• ë°©ë²•ì„ ì‹¤ìŠµí•©ë‹ˆë‹¤."
---

## ë“¤ì–´ê°€ë©°

**Pipe**ëŠ” ê°€ì¥ ì˜¤ë˜ë˜ê³  ê¸°ë³¸ì ì¸ IPC ë©”ì»¤ë‹ˆì¦˜ì…ë‹ˆë‹¤. Shellì—ì„œ ë§¤ì¼ ì‚¬ìš©í•˜ëŠ” `|` ê¸°í˜¸ê°€ ë°”ë¡œ íŒŒì´í”„ì…ë‹ˆë‹¤. ê°„ë‹¨í•˜ì§€ë§Œ ê°•ë ¥í•œ íŒŒì´í”„ì˜ ì„¸ê³„ë¡œ ë“¤ì–´ê°€ë´…ì‹œë‹¤.

## Pipeì˜ ê°œë…

### ê¸°ë³¸ êµ¬ì¡°

```mermaid
graph LR
    Writer[Writer Process<br/>fd[1]]
    PipeBuffer[Pipe Buffer<br/>Kernel Space<br/>64KB]
    Reader[Reader Process<br/>fd[0]]

    Writer -->|write()| PipeBuffer
    PipeBuffer -->|read()| Reader

    style Writer fill:#e1f5ff,stroke:#0288d1
    style Reader fill:#c8e6c9,stroke:#388e3c
    style PipeBuffer fill:#fff9c4,stroke:#f57f17
```

### í•µì‹¬ íŠ¹ì§•

1. **ë‹¨ë°©í–¥ FIFO**: First In, First Out
2. **ì»¤ë„ ë²„í¼**: ë³´í†µ 64KB (ì‹œìŠ¤í…œë§ˆë‹¤ ë‹¤ë¦„)
3. **íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°**: `pipefd[0]` (ì½ê¸°), `pipefd[1]` (ì“°ê¸°)
4. **ë¶€ëª¨-ìì‹ ê´€ê³„**: `fork()` ì‹œ ìƒì†ë¨

## Shell Pipeì˜ ë™ì‘ ì›ë¦¬

### ëª…ë ¹ì–´

```bash
ls -la | grep "txt" | wc -l
```

### ë‚´ë¶€ êµ¬ì¡°

```mermaid
graph LR
    Shell[Shell Process]

    subgraph "Pipe 1"
        LS[ls -la<br/>stdout]
        Pipe1[Pipe Buffer 1]
        Grep_in[grep stdin]
    end

    subgraph "Pipe 2"
        Grep_out[grep stdout]
        Pipe2[Pipe Buffer 2]
        WC[wc -l<br/>stdin]
    end

    Shell -->|fork + exec| LS
    LS -->|write| Pipe1
    Pipe1 -->|read| Grep_in
    Grep_out -->|write| Pipe2
    Pipe2 -->|read| WC
    WC -->|ê²°ê³¼| Shell

    style Pipe1 fill:#fff9c4,stroke:#f57f17
    style Pipe2 fill:#fff9c4,stroke:#f57f17
```

## Pipe ìƒì„± ë° ì‚¬ìš©

### ê¸°ë³¸ API

```c
#include <unistd.h>

int pipe(int pipefd[2]);
```

- **ë°˜í™˜ê°’**: ì„±ê³µ ì‹œ 0, ì‹¤íŒ¨ ì‹œ -1
- **pipefd[0]**: ì½ê¸°ìš© íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°
- **pipefd[1]**: ì“°ê¸°ìš© íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°

### ê°„ë‹¨í•œ ì˜ˆì œ

```c
// pipe_basic.c
#include <stdio.h>
#include <unistd.h>
#include <string.h>

int main() {
    int pipefd[2];
    char buffer[100];

    // 1. Pipe ìƒì„±
    if (pipe(pipefd) == -1) {
        perror("pipe");
        return 1;
    }

    // 2. Fork
    pid_t pid = fork();

    if (pid == 0) {
        // ìì‹ í”„ë¡œì„¸ìŠ¤: Reader
        close(pipefd[1]);  // ì“°ê¸° ë ë‹«ê¸°

        ssize_t n = read(pipefd[0], buffer, sizeof(buffer));
        buffer[n] = '\0';
        printf("ìì‹ì´ ë°›ìŒ: %s\n", buffer);

        close(pipefd[0]);
    } else {
        // ë¶€ëª¨ í”„ë¡œì„¸ìŠ¤: Writer
        close(pipefd[0]);  // ì½ê¸° ë ë‹«ê¸°

        const char *msg = "Hello from Parent!";
        write(pipefd[1], msg, strlen(msg));

        close(pipefd[1]);
        wait(NULL);  // ìì‹ ì¢…ë£Œ ëŒ€ê¸°
    }

    return 0;
}
```

### ì‹¤í–‰

```bash
gcc -o pipe_basic pipe_basic.c
./pipe_basic

# ì¶œë ¥:
# ìì‹ì´ ë°›ìŒ: Hello from Parent!
```

### ë™ì‘ ê³¼ì •

```mermaid
sequenceDiagram
    participant P as Parent
    participant K as Kernel (Pipe Buffer)
    participant C as Child

    P->>K: pipe() ìƒì„±
    Note over P,C: fork()ë¡œ í”„ë¡œì„¸ìŠ¤ ë³µì‚¬

    P->>P: close(pipefd[0])
    C->>C: close(pipefd[1])

    P->>K: write("Hello from Parent!")
    Note over K: ë²„í¼ì— ì €ì¥

    C->>K: read()
    K-->>C: "Hello from Parent!"

    P->>P: close(pipefd[1])
    C->>C: close(pipefd[0])
```

## ì™œ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ëì„ ë‹«ì•„ì•¼ í• ê¹Œ?

### ë¬¸ì œ ìƒí™©: ë‹«ì§€ ì•Šìœ¼ë©´?

```c
// ì˜ëª»ëœ ì˜ˆ
if (pid == 0) {
    // ìì‹: pipefd[1]ì„ ë‹«ì§€ ì•ŠìŒ!
    read(pipefd[0], buffer, sizeof(buffer));
    // ğŸ”¥ ë¬´í•œ ëŒ€ê¸° ê°€ëŠ¥!
}
```

### ì´ìœ 

```mermaid
graph TB
    subgraph "ì˜¬ë°”ë¥¸ ì‚¬ìš©"
        P1[Parent<br/>close read end]
        C1[Child<br/>close write end]
        Pipe1[Pipe]

        P1 -->|write only| Pipe1
        Pipe1 -->|read only| C1
    end

    subgraph "ì˜ëª»ëœ ì‚¬ìš©"
        P2[Parent<br/>write + read ì—´ë¦¼]
        C2[Child<br/>write + read ì—´ë¦¼]
        Pipe2[Pipe]

        P2 <-->|ì–‘ìª½ ì—´ë¦¼| Pipe2
        Pipe2 <-->|ì–‘ìª½ ì—´ë¦¼| C2
        Note2[EOF ì‹ í˜¸ ì „ë‹¬ ì•ˆ ë¨<br/>ë¬´í•œ ëŒ€ê¸° ê°€ëŠ¥]
    end

    style Note2 fill:#ffccbc,stroke:#d84315
```

**í•µì‹¬**: ëª¨ë“  ì“°ê¸° ëì´ ë‹«í˜€ì•¼ `read()`ê°€ EOF (0)ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

## ì–‘ë°©í–¥ í†µì‹ 

### ë‘ ê°œì˜ Pipe ì‚¬ìš©

```c
// bidirectional_pipe.c
#include <stdio.h>
#include <unistd.h>
#include <string.h>

int main() {
    int pipe_p2c[2];  // Parent to Child
    int pipe_c2p[2];  // Child to Parent
    char buffer[100];

    pipe(pipe_p2c);
    pipe(pipe_c2p);

    if (fork() == 0) {
        // ìì‹
        close(pipe_p2c[1]);  // P2C ì“°ê¸° ë‹«ê¸°
        close(pipe_c2p[0]);  // C2P ì½ê¸° ë‹«ê¸°

        // ë¶€ëª¨ë¡œë¶€í„° ë°›ê¸°
        read(pipe_p2c[0], buffer, sizeof(buffer));
        printf("ìì‹ ë°›ìŒ: %s\n", buffer);

        // ë¶€ëª¨ì—ê²Œ ë³´ë‚´ê¸°
        write(pipe_c2p[1], "Pong", 4);

        close(pipe_p2c[0]);
        close(pipe_c2p[1]);
    } else {
        // ë¶€ëª¨
        close(pipe_p2c[0]);  // P2C ì½ê¸° ë‹«ê¸°
        close(pipe_c2p[1]);  // C2P ì“°ê¸° ë‹«ê¸°

        // ìì‹ì—ê²Œ ë³´ë‚´ê¸°
        write(pipe_p2c[1], "Ping", 4);

        // ìì‹ìœ¼ë¡œë¶€í„° ë°›ê¸°
        read(pipe_c2p[0], buffer, sizeof(buffer));
        printf("ë¶€ëª¨ ë°›ìŒ: %s\n", buffer);

        close(pipe_p2c[1]);
        close(pipe_c2p[0]);
        wait(NULL);
    }

    return 0;
}
```

### êµ¬ì¡°

```mermaid
graph TB
    Parent[Parent Process]
    Child[Child Process]

    Pipe1[Pipe 1<br/>Parent â†’ Child]
    Pipe2[Pipe 2<br/>Child â†’ Parent]

    Parent -->|write| Pipe1
    Pipe1 -->|read| Child
    Child -->|write| Pipe2
    Pipe2 -->|read| Parent

    style Pipe1 fill:#e1f5ff,stroke:#0288d1
    style Pipe2 fill:#c8e6c9,stroke:#388e3c
```

## ì‹¤ì „ ì˜ˆì œ: ê°„ë‹¨í•œ Shell íŒŒì´í”„ë¼ì¸ êµ¬í˜„

### ëª©í‘œ

```bash
./mypipe "ls -la" "grep txt"
```

### ì½”ë“œ

```c
// mypipe.c
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <string.h>
#include <sys/wait.h>

void execute_command(char *cmd, char **args) {
    // "ls -la" â†’ ["ls", "-la", NULL]
    char *token = strtok(cmd, " ");
    int i = 0;
    while (token != NULL) {
        args[i++] = token;
        token = strtok(NULL, " ");
    }
    args[i] = NULL;
}

int main(int argc, char *argv[]) {
    if (argc != 3) {
        fprintf(stderr, "Usage: %s <cmd1> <cmd2>\n", argv[0]);
        return 1;
    }

    int pipefd[2];
    pipe(pipefd);

    // ì²« ë²ˆì§¸ ëª…ë ¹ ì‹¤í–‰
    if (fork() == 0) {
        close(pipefd[0]);  // ì½ê¸° ë‹«ê¸°
        dup2(pipefd[1], STDOUT_FILENO);  // stdoutì„ pipeë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
        close(pipefd[1]);

        char *args[10];
        execute_command(argv[1], args);
        execvp(args[0], args);
        perror("execvp");
        exit(1);
    }

    // ë‘ ë²ˆì§¸ ëª…ë ¹ ì‹¤í–‰
    if (fork() == 0) {
        close(pipefd[1]);  // ì“°ê¸° ë‹«ê¸°
        dup2(pipefd[0], STDIN_FILENO);  // stdinì„ pipeì—ì„œ ì½ê¸°
        close(pipefd[0]);

        char *args[10];
        execute_command(argv[2], args);
        execvp(args[0], args);
        perror("execvp");
        exit(1);
    }

    // ë¶€ëª¨ëŠ” ëª¨ë“  íŒŒì´í”„ ë‹«ê¸°
    close(pipefd[0]);
    close(pipefd[1]);

    // ìì‹ë“¤ ëŒ€ê¸°
    wait(NULL);
    wait(NULL);

    return 0;
}
```

### ì‹¤í–‰

```bash
gcc -o mypipe mypipe.c
./mypipe "ls -la" "grep .c"

# ì¶œë ¥:
# -rw-r--r--  1 user  staff   1234 Jan 22 10:00 mypipe.c
# -rw-r--r--  1 user  staff    567 Jan 22 09:30 pipe_basic.c
```

## Pipe í¬ê¸° ë° ì œí•œ

### í™•ì¸ ë°©ë²•

```bash
# Linuxì—ì„œ ê¸°ë³¸ íŒŒì´í”„ í¬ê¸° í™•ì¸
cat /proc/sys/fs/pipe-max-size

# ì¶œë ¥ ì˜ˆ: 1048576 (1MB)
```

### í¬ê¸° ë³€ê²½ (Linux)

```c
#include <fcntl.h>

int pipefd[2];
pipe(pipefd);

// íŒŒì´í”„ í¬ê¸° ì„¤ì • (1MB)
fcntl(pipefd[1], F_SETPIPE_SZ, 1024 * 1024);

// í˜„ì¬ í¬ê¸° í™•ì¸
int size = fcntl(pipefd[1], F_GETPIPE_SZ);
printf("Pipe size: %d bytes\n", size);
```

### Blocking vs Non-blocking

```mermaid
sequenceDiagram
    participant W as Writer
    participant Pipe as Pipe Buffer (64KB)
    participant R as Reader

    Note over W: 100KB ë°ì´í„° ì“°ê¸°

    W->>Pipe: write(64KB)
    Note over Pipe: ë²„í¼ ê°€ë“ ì°¸
    W->>W: Blocked...

    R->>Pipe: read(64KB)
    Note over Pipe: ë²„í¼ ë¹„ì›Œì§

    Note over W: Unblocked!
    W->>Pipe: write(36KB)
```

**Non-blocking ì„¤ì •**:

```c
#include <fcntl.h>

int flags = fcntl(pipefd[1], F_GETFL);
fcntl(pipefd[1], F_SETFL, flags | O_NONBLOCK);

// ì´ì œ write()ê°€ EAGAIN ë°˜í™˜ ê°€ëŠ¥
```

## ì„±ëŠ¥ ìµœì í™”

### 1. ë²„í¼ í¬ê¸° ìµœì í™”

```c
// ì‘ì€ ë²„í¼: ë§ì€ ì‹œìŠ¤í…œ ì½œ
char buffer[1];  // âŒ ë¹„íš¨ìœ¨ì 

// í° ë²„í¼: ì ì€ ì‹œìŠ¤í…œ ì½œ
char buffer[4096];  // âœ… íš¨ìœ¨ì 
```

### 2. splice() ì‚¬ìš© (Linux)

```c
#include <fcntl.h>

// Zero-copy íŒŒì´í”„ â†’ íŒŒì¼
ssize_t bytes = splice(pipefd[0], NULL, file_fd, NULL,
                       size, SPLICE_F_MOVE);
```

### ì„±ëŠ¥ ë¹„êµ

| ë°©ë²• | 1MB ì „ì†¡ ì‹œê°„ | CPU ì‚¬ìš© |
|------|---------------|----------|
| read/write (1 byte) | 500ms | ë†’ìŒ |
| read/write (4KB) | 5ms | ë³´í†µ |
| splice() | 2ms | ë‚®ìŒ |

## ë¬¸ì œ í•´ê²°

### Broken Pipe ì—ëŸ¬

```bash
# ì—ëŸ¬ ì˜ˆ
ls | head -1
# ê°€ë” "write: broken pipe" ì—ëŸ¬
```

**ì›ì¸**: Readerê°€ ë¨¼ì € ì¢…ë£Œ â†’ Writerê°€ SIGPIPE ë°›ìŒ

**í•´ê²°**:

```c
signal(SIGPIPE, SIG_IGN);  // SIGPIPE ë¬´ì‹œ

// write() ì‹œ EPIPE ì—ëŸ¬ ì²´í¬
if (write(pipefd[1], data, size) == -1) {
    if (errno == EPIPE) {
        printf("Readerê°€ ì¢…ë£Œë¨\n");
    }
}
```

### ë°ë“œë½ ë°©ì§€

```c
// âŒ ë°ë“œë½ ê°€ëŠ¥
write(pipe, large_data, 10MB);  // ë²„í¼ ê°€ë“ â†’ Block
read(pipe, buffer, size);  // ì‹¤í–‰ ì•ˆ ë¨!

// âœ… í•´ê²°: ë³„ë„ í”„ë¡œì„¸ìŠ¤/ìŠ¤ë ˆë“œ
if (fork() == 0) {
    write(pipe, large_data, 10MB);
} else {
    read(pipe, buffer, size);
}
```

## Pipe vs Named Pipe ë¹„êµ

| í•­ëª© | Pipe | Named Pipe (FIFO) |
|------|------|-------------------|
| **íŒŒì¼ì‹œìŠ¤í…œ** | âŒ ì—†ìŒ | âœ… ìˆìŒ (/tmp/fifo) |
| **í”„ë¡œì„¸ìŠ¤ ê´€ê³„** | ë¶€ëª¨-ìì‹ | ë¬´ê´€ |
| **ìƒì¡´ ê¸°ê°„** | í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ ì‹œ ì‚­ì œ | ëª…ì‹œì  ì‚­ì œ í•„ìš” |
| **ì‚¬ìš© ë³µì¡ë„** | ê°„ë‹¨ | ì•½ê°„ ë³µì¡ |

## ë‹¤ìŒ ë‹¨ê³„

Pipeì˜ ë™ì‘ ì›ë¦¬ë¥¼ ì™„ì „íˆ ì´í•´í–ˆìŠµë‹ˆë‹¤! ë‹¤ìŒ ê¸€ì—ì„œëŠ”:
- **Named Pipe (FIFO)** - ë¬´ê´€í•œ í”„ë¡œì„¸ìŠ¤ ê°„ í†µì‹ 
- íŒŒì¼ì‹œìŠ¤í…œ ê¸°ë°˜ IPC
- ì‹¤ì „ ì„œë²„-í´ë¼ì´ì–¸íŠ¸ êµ¬ì¡°

---

**ì‹œë¦¬ì¦ˆ ëª©ì°¨**
1. IPCë€ ë¬´ì—‡ì¸ê°€ - í”„ë¡œì„¸ìŠ¤ ê°„ í†µì‹ ì˜ í•„ìš”ì„±
2. IPC ë©”ì»¤ë‹ˆì¦˜ ì „ì²´ ê°œìš” - 7ê°€ì§€ ë°©ì‹ ë¹„êµ
3. **Pipe - ê°€ì¥ ê¸°ë³¸ì ì¸ IPC** â† í˜„ì¬ ê¸€
4. Named Pipe (FIFO) - ì´ë¦„ ìˆëŠ” íŒŒì´í”„ (ë‹¤ìŒ ê¸€)
5. Signal - ë¹„ë™ê¸° ì´ë²¤íŠ¸ í†µì‹ 

> ğŸ’¡ **Quick Tip**: PipeëŠ” ë¶€ëª¨-ìì‹ ê´€ê³„ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤. ë¬´ê´€í•œ í”„ë¡œì„¸ìŠ¤ ê°„ í†µì‹ ì´ í•„ìš”í•˜ë‹¤ë©´ Named Pipe ë˜ëŠ” Unix Socketì„ ì‚¬ìš©í•˜ì„¸ìš”!
